Source: 
1- https://learnsql.com/blog/common-sql-job-interview-questions/
2- https://www.dataquest.io/blog/sql-interview-questions/ 
3- https://www.interviewquery.com/blog-sql-interview-questions/

SQL Exercise 1 – Write a Statement
Write an SQL statement that lists school names, student names, and their cities only if the school and the student are in the same city and the student is not from New York.

Table: school
school_id       school_name                    city
-----------     ------------------       ----------
1               Stanford                   Stanford
2               University of Cali    San Francisco
3               Harvard University         New York
4               MIT                          Boston
5               Yale                      New Haven

Table: student
student_id   student_name  city           school_id
-----------  ------------  ----------   -----------
1001         Peter Brebec  New York              1
1002         John Goorgy   San Francisco         2
2003         Brad Smith    New York              3
1004         Fabian Johns  Boston                5
1005         Brad Cameron  Stanford              1
1006         Geoff Firby   Boston                5
1007         Johnny Blue   New Haven             2
1008         Johse Brook   Miami                 2

Query:
Select student_name,school_name,city
From school as sc
Left join student as st ON st.school_id=sc.school_id
Where st.city = sc.city and st.city <>'New York';

SQL Exercise 2 – Write a Statement
Write an SQL statement that lists student names, subject names, subject lecturers, and the max amount of points for all subjects except Computer Science and any subjects with a max score between 100 and 200.

Table: subject
subject_id  subject_name          max_score    lecturer
----------  ----------            ----------   -----------
 11         Math                  130          Christena Solem
 12         Computer Science      150          Jaime Pille
 13         Biology               300          Carrol Denmark
 14         Geography             220          Yuette Galang
 15         Physics               110          Colton Rather
 16         Chemistry             400          Nan Mongeau

Table: student
student_id   student_name    city           subject_id
-----------  ------------    ----------    -----------
2001         Thurman Thorn   New York               11
2002         Sharda Clemens  San Francisco          12
2003         Buck Elkins     New York               13
2004         Fabian Johns    Boston                 15
2005         Brad Cameron    Stanford               11
2006         Sofia Roles     Boston                 16
2007         Rory Pietila    New Haven              12

Query:
Select student_name,subject_name,lecturer,max_score
From subject as sb
Left join student as st ON st.subject_id=sb.subject_id
Where subject<>'Computer Science' and max_score between 100 and 200;

SQL Exercise 3 – Find the Error
What is wrong with this SQL query?

Code 1:
SELECT Id, name, YEAR(BillingDate) AS Year
FROM Records
WHERE Year >= 2010

Code 2:
SELECT id, name
FROM students
WHERE grades =
             (SELECT MAX(grades)
              FROM students
              GROUP BY subject_id;);

Answer:
Code 1: Used "Year" at Where clause instead of "YEAR(BillingDate)". And forgated ';'.
Code 2: We don't need Group by at Subquery. If we add this to select, then there will be multiple rows. Since it is equal we can delete this row.

SQL Exercise 4 – Find the Result
Given the following tables …

Table: worker
id    name
---   -----------
1     Guillermo Sparks
2     Gene      Roberts
3     Ally Jones
4     Bryant Summers
5     Candice Green

Table: departments
id    name            manager_id
---   -------------    ---------
1     Financial               3
2     Strategy                5
3     IT                      1
4     Marketing            NULL
… What will be the result of the query below?

Code:
SELECT name
FROM worker
WHERE id NOT IN (SELECT manager_id FROM departments)

Answer:
name
-------------
 Gene Roberts
 Bryant Summers

SQL Exercise 5 – Write a Query
The EMPLOYEE table has the following attributes: NAME, DEPT_ID, and SALARY. Write a query that shows the highest salary in each department.

Select DEPT_ID, Max(SALARY) as max_salary
From EMPLOYEE
Group by 1;

SQL Exercise 6 – Write a Date Query
Write an SQL query that displays the current date.

Answer:
Select current_date;

SQL Exercise 8 – Find and Delete Duplicates
Write an SQL query to find duplicate rows in two tables (EMPLOYEE and WORKERS), and then write a query to delete the duplicates.

Answer:
Select emp.id, count(emp.id) as id_count
from EMPLOYEE as emp
inner join WORKERS as wr ON emp.id=wr.employee_id
group by 1
having id_count >1;

Delete From EMPLOYEE
Where (Select emp.id
from EMPLOYEE as emp
inner join WORKERS as wr ON emp.id=wr.employee_id
group by 1
having id_count >1);

SQL Exercise 9 – Write a Complex Query
Write a query that lists courses’ subject names and the number of students taking the course only if the course has three or more students enrolled.

Table: subject
subject_id  subject_name       max_score        lecturer
----------  ----------         ----------       -----------  
 11         Math                    130         Christena Solem 
 12         Computer Science         50         Jaime Pille 
 13         Biology                 300         Carrol Denmark 
 14         Geography               220         Yuette Galang 
 15         Physics                 110         Colton Rather 
 16         Chemistry               400         Nan Mongeau
Table: student
student_id   student_name       city           subject_id
-----------  ------------       ----------    -----------
2001         Thurman Thorn      New York               11
2002         Sharda Clemens     San Francisco          12
2003         Buck Elkins        New York               13
2004         Fabian Johns       Boston                 15
2005         Brad Cameron       Stanford               11
2006         Sofia Roles        Boston                 16
2007         Rory Pietila       New Haven              12
2008         Cicely Weish       Tulsa                  14
2011         Richard Curtin     Boston                 11
2012         Kassy Ledger       Stanford               11
2013         Henry Ledger       Miami                  13
2014         Darius Fidzberg    San Francisco          12
2015         Darcey Fiorillo    Chicago                14


Answer: 
Select subject_name, count(student_id) as student_id_count
from subject as sb
left join student as st on st.subject_id=sb.subject_id
group by 1
having student_id_count >2; 

Question 2-1
Given the table below, write a SQL query that retrieves the personal data about alumni who scored above 16 on their calculus exam.

Table alumni

student_id	name	surname	birth_date	faculty
347	        Daniela	Lopes	1991-04-26	Medical School
348	        Robert	Fischer	1991-03-09	Mathematics

Table evaluation

student_id	class_id	exam_date	grade
347	        74	        2015-06-19	16
347	        87	        2015-06-06	20
348	        74	        2015-06-19	13

Table curricula

class_id	class_name	professor_id	semester
74	        algebra	    435	            2015_summer
87	        calculus	532	            2015_summer
46	        statistics	625	            2015_winter

Answer: 
Select alumni.*
from alumni as a
left join evaluation as e on a.student_id=e.student_id
left join curricula as c on c.class_id=e.class_id
Where grade > 16 and class_name= "calculus":

Question 2-2
We’ll work with the beverages table. Its first rows are given below.

id	name	    launch_year	fruit_pct	contributed_by
1	Bruzz	    2007	     45	        Sam Malone
2	Delightful	2008	     41	        Sam Malone
3	Nice	    2015	     42	        Sam Malone
Write a query to extract only beverages where fruit_pct is between 35 and 40 (including both ends).

Answer:
Select id,name
from beverages
where fruit_pct>= 35 and fruit_pct<=40;

Question 2-3
We’ll work with the beverages table again. Its first rows are given below.

id	name	launch_year	fruit_pct	contributed_by
1	Bruzz	2007	45	Sam Malone
2	Delightful	2008	41	Sam Malone
3	Nice	2015	42	Sam Malone
Write a query to extract only beverages whose contributor only has one name

Answer: 
select name
from beverages
where contributed_by not like '% %';

Question 2-4
We’ll work with the beverages table again. Its first rows are given below.

id	name	     launch_year	fruit_pct	contributed_by
1	Bruzz	     2007	          45	    Sam Malone
2	Delightful	 2008	          41	    Sam Malone
3	Nice	     2015	          42	    Sam Malone
Write a query that finds the average fruit_pct by contributor and displays it ascending order.

Answer:
Select contributed_by, avg(fruit_pct) avg_fruit_pct
from beverages
group by 1
order by 2:

Question 3-1
We are given two tables, a users table with demographic information and the neighborhood they live in and a neighborhoods table. 
Write a query that returns all of the neighborhoods that have 0 users.

users table:

COLUMNS	              TYPE
id	              int
name	              varchar
neighborhood_id	int
created_at	      datetime

neighborhoods table:

COLUMNS	    TYPE
id	    int
name	    varchar
city_id	    int

Hint: Our aim to find all the neighborhoods without users. In a sense we need all the neighborhoods that do not have a singular user living in them. 
This means we have to introduce a concept of existence of a column in one table, but not in the other.

Answer: 
select id 
from (select n.id, count(u.id) as user_count
from neighborhoods as n 
left join users as u on n.id=u.neighborhood_id
group by 1
having user_count=0) t;

Question 3-2: Write a query to return pairs of projects where the end date of one project matches the start date of another project.

projects table:

COLUMN	    TYPE
id	        integer
title	    string
start_date	datetime
end_date	datetime
budget	    float

Output:

COLUMN	            TYPE
project_title_end	string
project_title_start	string
date	            datetime
Here, we are trying to use values in a single table to generate comparisons. Specifically, we are looking for pairs of projects such that one project starts on the same day that another project ends.

This will require us to perform a self-join.

Hint: Remember, when performing a self-join, the order of your values is very important. You will want to be particular about aliasing to make sure you keep your tables straight.

Answer: 
select t2.title as project_title_end, t1.title as project_title_start, date
from projects t1
inner join projects t2 ON t1.id=t2.id
Where t1.start_date < t2.end_date;

Question 3-3:You are given a table that represents search results from searches on Facebook. 
The query column is the search term, position column represents each position the search result came in, 
and the rating column represents the human rating of the search result from 1 to 5 where 5 is high relevance and 1 is low relevance.

1. Write a query to compute a metric to measure the quality of the search results for each query.

2. You want to be able to compute a metric that measures the precision of the ranking system based on position. For example, if the results for dog and cat are....

QUERY	RESULT_ID	POSITION	RATING	NOTES
dog	    1000	     1	         2	    picture of hotdog
dog	    998	         2	         4	    dog walking
dog	    342	         3	         1	    zebra
cat	    123	         1	         4	    picture of cat
cat	    435	         2	         2	    cat memes
cat	    545	         3	         1	    pizza shops
...we would rank 'cat' as having a better search result ranking precision than 'dog' based on the correct sorting by rating.

Write a query to create a metric that can validate and rank the queries by their search result precision. Round the metric (avg_rating column) to 2 decimal places.

search_results table:

COLUMN	    TYPE
query	    Varchar
result_id	integer
position	integer
rating	    integer
The ratings of each search result (1 to 5 where 5 is high relevance and 1 is low relevance) could be used to compute a metric that measures the quality of the search results for each query.

For example, if the search query for 'tiger' has 5s for each result, then that would average to be a perfect result. Therefore, taking the average of the ratings seems like a good way to measure the quality of the search results.

Answer: 
with a as (
select query, avg(position) avg_pos, avg(rating) avg_rat,
std(position) std_pos, std(rating) std_rat
from search_results group by 1)

select s.query,
sum((position -avg_pos)(rating - avg_rat))/
((count()-1)std_posstd_rat)
as avg_rating
from search_results s join a on s.query = a.query
GROUP BY 1;